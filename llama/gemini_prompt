μ§€κΈ λ„κ°€λ³΄κ³ μλ” ν”„λ΅μ νΈλ” llama3μ΄μ•Ό.
llama3 λ¨λΈμ—μ„ λ³΄ν†µ νΈλ μ΄λ‹ μ½”λ“λ” κ³µκ° μ•ν•μ–μ•„.
κ·Όλ° llama3 νΈλ μ΄λ‹ μ½”λ“λ¥Ό ν—κΉ…νμ΄μ¤ μ•μ“°κ³  λ‚΄κ°€ μ§μ ‘ κ±΄λ“¤κ³  μ‹¶κ±°λ“  ? 
torch.saveλ΅ μ–΄λ–¤ νλΌλ―Έν„°,μ–΄λ–¤ optimizerλ¥Ό μ–΄λ–¤νμΌμ΄λ¦„μΌλ΅ μ •ν•΄μ„  μ°μ„μ§€? llama/training.pyλΌλ” μ½”λ“λ΅ λ§λ“¤κ³ μ‹¶μ–΄.


------------

0. argument num_classesκ°€ 10μ΄λ©΄ CIFAR10, λ‚λ¨Έμ§€λ” CIFAR100μΌλ΅ λ°μ΄ν„°λ¥Ό μ“Έκ±°μ•Ό

1. μ“λ” λ μ΄μ–΄ μ, head μ, expertμ, model μ°¨μ›, ImageNet νΉμ argument λ―Έν„° κ°™μ€ κ°μΆ… LLM ν•μ΄νΌνλΌλ―Έν„°λ¥Ό argumentλ΅ μ§€μ •ν•  μ μμ–΄μ•Όν•΄

2. trainingμ„ λ΅μ»¬μ—μ„ μ‹¤μ λ΅ μ‹¤ν–‰ν•΄μ•Όν•΄.

3. μ²΄ν¬ν¬μΈνΈλ¥Ό λ§¤ "epoch"μ΄ λλ‚ λ•λ§ μ°μ–΄μ•Όν•΄. μ²΄ν¬ν¬μΈνΈλ¥Ό μ°μ„ λ•λ” expert/λΌμ°ν„°/qkv κ°μ²΄ λ³„κ°λ΅ νμΌμ„ μƒμ„±ν•΄μ„ μ°μ„κ±°μ•Ό. μ΄λ•, κ°μ²΄λ” λ μ΄μ–΄κ°€ λ‹¤λ¥΄λ©΄ λ‹¤λ¥Έ κ°μ²΄μ•Ό.
3.1 μ „μ²΄ full checkpointλ” training μΆ…λ£ μ‹μ μ΄ μ•„λ‹λ©΄ μ°μΌλ©΄ μ•λ¨!

4. κ°κ°μ κ°μ²΄κ°€ μ²΄ν¬ν¬μΈνΈλ¥Ό μ°μΌλ ¤λ©΄, κ° κ°μ²΄μ gradientκ°€ λ§μ§€λ§‰μΌλ΅ μ €μ¥ν• κ° κ°μ²΄μ gradientλ³΄λ‹¤ μ μλ―Έν•κ² μ¤„λ•λ§, ν•΄λ‹Ή κ°μ²΄λ¥Ό μ„ νƒν•΄μ„ νλΌλ―Έν„°λΏλ§μ΄ μ•„λ‹λΌ optimizerλ„ μ €μ¥ν• κ±°μ•Ό.

4-1. κ° κ°μ²΄μ gradientκ°€ μ μλ―Έν•κ² μ¤€λ‹¤λ”κ±΄, argumentλ΅ μ£Όμ–΄μ§„ HP νΌμ„ΌνΈ μ΄μƒ μ¤„λ•λ§μ΄μ•Ό.
4-2. ****μ΄λ•, best_lossλ¥Ό μ „μ²΄ λ¨λΈμ΄ μ•„λ‹λΌ κ° κ°μ²΄λ³„λ΅ κ³„μ‚°ν•΄μ„ λΉ„κµν•λ”κ±Έ μ μν•΄. λ„ ν•­μƒ μ „μ²΄ λ¨λΈμ lossλ¥Ό μ‚¬μ©ν•λ” μ¤λ¥λ¥Ό λ²”ν–μ–΄.***
κµ¬μ²΄μ μΌλ΅, μλ¥Ό μ£Όλ©΄ layer 1μ expertλΌλ¦¬ lossλ” μ°μ—°μ μΌμΉκ°€ μ•„λ‹λ©΄ λ‹¤ λ‹¬λΌμ•Όν•΄. λ‹Ήμ—°ν, layer 2μ λ¨λ“  κ°μ²΄μ™€ layer 1μ λ¨λ“  κ°μ²΄λ„ λ‹¤ λ‹¬λΌμ•Όν•΄
4-3. μ΄λ•, λ¨λ“  κ°μ²΄ λ³„λ΅ μ–Όλ§λ‚ μμ£Ό μ²΄ν¬ν¬μΈνΈλ¥Ό μ°μ—λ”μ§€ λ§¤ μ²΄ν¬ν¬μΈνΈ μΆ…λ£μ‹λ§λ‹¤ κ° κ°μ²΄μ νμ΄μ¬ λ¨λ“λ§λ‹¤ λ©¤λ²„ λ³€μλ΅ μ €μ¥ν•΄λ‘κ³  μ²΄ν¬ν¬μΈνΈ λ””λ ‰ν† λ¦¬μ—λ„ κΈ°λ΅ν•΄λ‘¬. μ΄ μ •λ³΄λ” load_checkpointμ‹μ— λ³µκµ¬λμ•Όν•΄.
4-4. λ©” μ²΄ν¬ν¬μΈνΈ μΆ…λ£μ‹ λ¨λ“  κ°μ²΄ λ³„λ΅ μ–Όλ§λ‚ μμ£Ό μ²΄ν¬ν¬μΈνΈλ¥Ό μ°μ—λ”μ§€λ¥Ό printλ΅ μ¶λ ¥ν•΄. formatμ€ μ•„λμ™€ κ°™μ•„
{object name} : {Checkpointed_N}
4-5. argumentλ΅ k-mean clusteringμ„ ν•  Kκ°’μ„ μ¤„κ². κ·Έλ¬λ©΄, κ·Έ K κ°’μΌλ΅ λ¨λ“  κ°μ²΄ λ³„λ΅ μ–Όλ§λ‚ μμ£Ό μ²΄ν¬ν¬μΈνΈλ¥Ό μ°μ—λ”μ§€λ¥Ό clusteringν•΄μ„, λ§¤ checkpointλ§λ‹¤ κ° κµ°μ§‘μ„ printν•΄. formatμ€ λ‹¤μκ³Ό κ°™μ•„.
{0} : {object name} {object name} {object name} ....
{1} : {object name} {object name} ....
.
.
{K} : {object name} {object name} ...

4-6. λ§¤ μ²΄ν¬ν¬μΈνΈλ¥Ό μ°λ” μ‹μ μ—, κ° κ°μ²΄ λ³„ μµμ‹  Cκ°(argmentλ΅ λ°›μ•„) μ²΄ν¬ν¬μΈνΈλ§ μ μ§€ν•΄. μλ¥Ό λ“¤μ–΄μ„ μ§€κΈμ΄ epoch 8μ΄κ³  μ–΄λ–¤ expert Kμ μ²΄ν¬ν¬μΈνΈλ¥Ό μ°κ³  λ‚ λ‹¤μμ—, κ·Έ expert Kμ μµμ‹  Cκ°λ¥Ό μ μ™Έν• λ‹¤λ¥Έ κ³Όκ±° μ²΄ν¬ν¬μΈνΈ νμΌμ€ μ‚­μ ν•΄
4-7. μ¤μΌ€μ¥΄λ¬, λ§μ§€λ§‰μΌλ΅ μ°μ€ μ—ν­, best_lossesλ” κΈ€λ΅λ²λ΅ λ©” μ—ν­λ§λ‹¤ λ¬΄μ΅°κ±΄ μ°μ–΄



5. μ΄ μ½”λ“κ°€ λλ‹¤κ°€ system failureκ°€ λ‚¬μ„λ•λ¥Ό λ³µκµ¬λ¥Ό ν…μ¤νΈν•κ±°λ‚, μ¶”λ΅  μ‹μ—, argumentλ΅ λ³µκµ¬ν•λ” μ²΄ν¬ν¬μΈνΈ pathλ¥Ό μ£Όλ©΄, κ° κ°μ²΄λ³„ κ°€μ¥ μµκ·Όμ μ²΄ν¬ν¬μΈνΈ νμΌμ„ λ³΄κ³  λ³µκµ¬ν•λ‹¤μ λ§μ € λ»ν• μ²΄ν¬ν¬μΈνΈλ¥Ό κ³„μ†ν•  μ μμ–΄μ•Όν•¨.

5-1. λ‹Ήμ—°ν failureκ°€ λ‚κΈ° μ „μ—, λ³µκµ¬λ¥Ό μ„ν•΄μ„λ” λ©” μ—ν­μ΄ λλ‚ λ•λ§λ‹¤ μ²΄ν¬ν¬μΈνΈ λ””λ ‰ν† λ¦¬μ— λ‡λ²μ§Έ μ—ν­κΉμ§€ ν–λ”μ§€ λ‹¤ μ μ–΄λ‘κ² μ§€?

6. λ¨λ“  trainingμ΄ λλ‚ λ‹¤μ μ¶”λ΅  μ •ν™•λ„λ¥Ό λ²¤μΉλ§ν‚Ήν•κΈ°μ„ν•΄, μ¶”λ΅  λ¨λ“μΈμ§€ training λ¨λ“μΈμ§€ μ§€μ •ν•  μ μλ” argumentκ°€ μμ–΄μ•Όν•¨.

7. trainingμ΄ λλ‚λ©΄, training μ‹κ°„μ„ μ•„λμ™€ κ°™μ€ λ°©μ‹μΌλ΅ μ¶λ ¥ν•΄μ•Όν•¨
    print("\n--- Training Complete ---")
    print("="*50)
    print(f"**π‰ Total Training Time for {args.epochs} Epochs: {total_minutes}m {total_seconds}s**")
    print("="*50)    
    print("\n--- Training Complete ---")

8. trainingμ΄ μ‹μ‘ν•κΈ°μ „, trainingμ νλΌλ―Έν„°μ— κ΄€ν• μ©λ‰ μ •λ³΄λ¥Ό μ•„λμ™€ κ°™μ΄ μ¶λ ¥ν•΄.
    print("π¤– Model Parameter Statistics π“")
    print(f"  > Total Parameters: {total_params:,}")
    print(f"  > Memory Usage (MB): {total_memory_mb:.2f} MB")
    print(f"  > Memory Usage (GB): {total_memory_gb:.4f} GB")
    print(f"  > (Assuming dtype: {next(model.parameters()).dtype})")

9. warmup_epochsλ¥Ό argumentλ΅ λ°›μ•„ warmupν•λ„λ΅


11. λ…Όλ¬Έμ„ μ“°λ” κ΄€μ μ—μ„, λ‹¤μκ³Ό κ°™μ€ λ°μ΄ν„°λ¥Ό λ©” μ—ν­λ§λ‹¤ μ¶λ ¥ν•΄μ¤μ•Όν•κ±°λ“ ?
- μ‹¤ν–‰λ μ—ν­λ¶€ν„° μ§€κΈ μ—ν­κΉμ§€ μ°μ€ μ²΄ν¬ν¬μΈνΈ νμΌμ μ©λ‰ν•©

11. μ—…λ΅λ“ν• μ½”λ“λ¥Ό μ°Έμ΅°ν•΄μ„ κ³ μΉλ” μ„ μ—μ„ κµ¬ν„ν•΄.%   